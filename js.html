<script>
    function insertarContacto()
    {   
        /* Obtener los datos */
        //Esto obtiene los id del formulario en main html
        let nombre = document.getElementById('nombre').value;
        let apellidos = document.getElementById('apellidos').value;
        let correo = document.getElementById('correo').value;
        let telf = document.getElementById('telf').value;

        /* Cerrar Modal */
        bootstrap.Modal.getInstance(document.getElementById('crearContactoModal')).hide();

        /* Eliminar la tabla */
        eliminarTabla();

        /* Insertar loader */
        crearLoaderAnillo('divContactos');
        /* aquí se escribe la función que trabajará con los valores devueltos por la función obtener contactos. que recuerda que es un array */
        google.script.run
        .withSuccessHandler(contactoInsertadoCorrectamente)
        .withFailureHandler(contactoInsertadoError)
        .insertarContacto(nombre, apellidos, correo, telf);         /* insertarContactos() es la función que se programa en el archivo funciones.js */
    }

    function contactoInsertadoCorrectamente(){
        //Eliminamos los datos de los inputs
        document.getElementById('nombre').value = '';
        document.getElementById('correo').value = '';

        //Mostrar notificacion
        crearNotificacionOk('Contacto insertado correctamente', 'CONTACTO OK')

        //Eliminar Loader
        eliminarLoader();

        //Mostrar la tabla
        crearTablaContactos();
    }

    function contactoInsertadoError(){
        crearNotificacionError('No se ha podido insertar el contacto','ERROR')
        //Eliminar Loader
        eliminarLoader();
        //Mostrar la tabla
        crearTablaContactos();
    }

    //Interactividad del Main
    function crearTablaContactos()
    {   
        /* Borrar Tabla */
        eliminarTabla();

        /* Insertar loader */
        crearLoaderAnillo('divContactos');
        /* aquí se escribe la función que trabajará con los valores devueltos por la función obtener contactos. que recuerda que es un array */
        google.script.run
        .withSuccessHandler(crearTablaContactosCorrectamente)
        .withFailureHandler(crearTablaContactosError)
        .obtenerContactos();         /* ObtenerContactos() es la función que se programa en el archivo funciones.js */
    }

    function crearTablaContactosCorrectamente(obj)
            {   


                tabla = document.createElement('table'); /* create elemen sirve para crear un elemento de tipo HTML */
                tabla.id = 'tablaContactos' /* Colocamos un id para que cuando aplanemos mostrar tabla compruebe si existe  */

                let tablaHeader = document.createElement('thead'); /* Interferir el bucle para que en la primera iteración determinemos cual es el encabezado. */
                let tablaBody = document.createElement('tbody');
                


                /* Crear tabla con bucle for */
                /* Header de la tabla */
                let primeraFila = document.createElement('tr');
                for(let i = 0; i < obj[0].length; i++){
                    let celda = document.createElement('td');
                    celda.textContent = obj[0][i];
                    primeraFila.appendChild(celda);
                    
                }
                    tablaHeader.appendChild(primeraFila);
                    tabla.appendChild(tablaHeader);
                /* Body de la tabla */
                for(let i = 1; i < obj.length; i++){
                    let fila = document.createElement('tr');
                    for (let j = 0; j < obj[i].length; j++){
                        let celda = document.createElement('td');
                        celda.textContent = obj[i][j];
                        fila.appendChild(celda);
                    } 
                    tablaBody.appendChild(fila);
                    
                }
                /* Agregamos clases a la cabecera */
                tablaHeader.classList.add('table-dark');
                /* Agregamos el cuerpo a la tabla */
                tabla.appendChild(tablaBody);
                /* Agregamos clases a la tabla */
                tabla.classList.add('table', 'table-striped', 'border', 'border-3','border-dark');
                /* Agregamos tabla a la página */
                document.getElementById('divContactos').appendChild(tabla);

                /* Mostrar notificación de ok */
                crearNotificacionOk('Contactos obtenidos correctamente','Todo en orden');
                
                /* Eliminar loader */
                eliminarLoader();
            }

    function crearTablaContactosError(){
        /* Mostrar una notificación */
        crearNotificacionError('No se han podido leer los contactos','ERROR');
        /* Eliminar loader */

        eliminarLoader();
    }


    function crearNotificacion(mensaje, titulo){
        document.getElementById('mensajeNotificacion').textContent = mensaje;
        document.getElementById('tituloNotificacion').textContent = titulo;
        let elementoNotificacion = document.getElementById('notificacion');
        bootstrap.Toast.getOrCreateInstance(elementoNotificacion).show();
    }

    function crearNotificacionOk(mensaje,titulo){
        crearNotificacion(mensaje,titulo)
        crearIconoNotificacionOk();
        crearColorNotificaion('--color-verde-obscuro')
    }

    function crearNotificacionError(mensaje,titulo){
        crearNotificacion(mensaje,titulo)
        crearIconoNotificacionError();
        crearColorNotificaion('--color-rojo-obscuro')
    }

    function crearNotificacionAdvertencia(mensaje,titulo){
        crearNotificacion(mensaje,titulo)
        crearIconoNotificacionAdvertencia();
        crearColorNotificaion('--color-amarillo-obscuro')
    }

    function crearIconoNotificacionOk(){
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-check2-square');
    }

    function crearIconoNotificacionError(){
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-bug');
    }

    function crearIconoNotificacionAdvertencia(){
        document.getElementById('iconoNotificacion').className = '';
        document.getElementById('iconoNotificacion').classList.add('bi', 'bi-exclamation-square');
        
    }

    function crearColorNotificaion(color){
        let elementoNotificacion = document.getElementById('notificacion');
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(color);

    }
    /* Esta función crea el loader */
    function crearLoader(elementoPadre){

        eliminarLoader();
        let loader = document.createElement('div');
        loader.id = 'loader';
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div')); /* Se crean 4 divs por que asi lo necesita el loader para funcionar con el css */
        return document.getElementById(elementoPadre).appendChild(loader);
    }

    function crearLoaderPuntos(elementoPadre){
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ellipsis'); /* Se le añade la clase al div principal */
    }

    function crearLoaderAnillo(elementoPadre){
        let loader = crearLoader(elementoPadre);
        loader.classList.add('lds-ring'); /* Se le añade la clase al div principal */
    }
    /* Esta funcion elimina el loader cuando termine la carga de la tabla */
    function eliminarLoader(){
        let loader = document.getElementById('loader');
        if(loader) loader.remove();
    }
    

    function eliminarTabla(){
        let tabla = document.getElementById('tablaContactos'); /* Tratamos de seleleccionar la tabla para comprobar si existe por que más adelante se crea una tabla con ese id */
        if (tabla) tabla.remove();
    }
    
    //******Esta es la función anterior que se cambio para hacer más reutilizable la creacion de nuevas notificaciones.
/*const NOTIFICACION_OK = 1;
const NOTIFICACION_DANGER = 2;
const NOTIFICACION_WARNING = 3;
*/
    /* function crearNotificacionOLD(tipo, mensaje, titulo){
    // Obtener los datos de la notificación
    let mensajeNotificacion = document.getElementById('mensajeNotificacion');
    let tituloNotificacion = document.getElementById('tituloNotificacion');
    let elementoNotificacion = document.getElementById('notificacion');
    let iconoNotificacion = document.getElementById('iconoNotificacion');
    let notificacion = bootstrap.Toast.getOrCreateInstance(elementoNotificacion);

    // Editar la notificacion
    mensajeNotificacion.textContent = mensaje;
    tituloNotificacion.textContent = titulo;
    
    switch(tipo){
        case NOTIFICACION_OK:
        iconoNotificacion.className = '';
        iconoNotificacion.classList.add('bi', 'bi-check2-square');
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-verde-obscuro');
        break;

        case NOTIFICACION_DANGER:
        iconoNotificacion.className = '';
        iconoNotificacion.classList.add('bi', 'bi-bug');
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-rojo-obscuro');
        break;

        case NOTIFICACION_WARNING:
        iconoNotificacion.className = '';
        iconoNotificacion.classList.add('bi', 'bi-exclamation-square');
        elementoNotificacion.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-amarillo-obscuro');
        break;
    } 


    // Mostrar la notificacion 
    notificacion.show()

} */

/************************ Crear tabla con bucle forEach*************************************/
/*   Array.from(obj).forEach((filaActual,i) =>
{
    let fila = document.createElement('tr');
    filaActual.forEach(celdaActual =>
    {
        let celda = document.createElement('td');
        celda.textContent = celdaActual;
        fila.appendChild(celda);
    });
    if(i === 0){
        tablaHeader.appendChild(fila);
        tabla.appendChild(tablaHeader);
    }
    else
    {
        tablaBody.appendChild(fila);
    }
    
});  */
</script>


